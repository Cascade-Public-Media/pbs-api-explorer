{#
General datatable view for Entity instances.

Availavble variables:
 - properties: An array of keys for entity properties to add to the table.
 - entities: An array of entity objects for the table.
 - title: Title for the page. (optional)
 - subtitle: Subtitle for the page. (optional)
 - entity_route: A Symfony route to use as a link for the first field. The
                 entity ID will be used an argument. (optional)
 - update_route: A Symfony route to update *all* instances of the provided
                 Entity. (optional)
#}

{% extends 'base.html.twig' %}
{% import '@AdminLTE/Macros/buttons.html.twig' as btn %}

{% block page_title %}
    {% if title is defined %}
        {{ title }}
    {% else %}
        Data table
    {% endif %}
{% endblock %}

{% block page_subtitle %}
    {% if subtitle is defined %}
        {{ subtitle }}
    {% endif %}
{% endblock %}

{% block page_content %}

    {% if is_granted('ROLE_ADMIN') %}
        <div class="well well-sm">
        {% block datatable_actions %}
            {% if update_route is defined %}
                {{ btn.link_button('Sync from API', path(update_route), 'fas fa-sync', 'success', 'xs') }}
            {% endif %}
        {% endblock %}
        </div>
    {% endif %}

    <table class="table table-bordered table-striped table-condensed datatable">
        <thead>
            <tr>
                {% for property in properties %}
                    <th>{{ property }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for entity in entities %}
                <tr>
                    {% for property, name in properties %}
                        {% set field = attribute(entity, property) %}
                        {% if field is instanceof('DateTime') or field is instanceof('DateTimeImmutable') %}
                            <td>{{ field|date('Y-m-d H:i') }}</td>
                        {% elseif field is boolean %}
                            <td>{{ field|bool_icon }}</td>
                        {% elseif loop.first and entity_route is defined %}
                            <td><a href="{{ path(entity_route, {'id': entity.id}) }}">{{ field }}</a></td>
                        {% elseif property == 'image' %}
                            <td><a href="{{ field }}" target="_blank">{{ field|split('/')|last }}</a></td>
                        {% else %}
                            <td>{{ field }}</td>
                        {% endif %}
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="application/javascript">
        $(document).ready( function () {
            $('.datatable').DataTable({
                "pageLength": 25
            });
        });
    </script>
{% endblock %}
